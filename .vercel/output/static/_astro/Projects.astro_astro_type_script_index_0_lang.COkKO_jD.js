function E(n,r){return n?n.length>r?n.substring(0,r)+"...":n:""}document.addEventListener("DOMContentLoaded",async()=>{const n=document.getElementById("projects-container"),r=document.getElementById("loading-state"),m=document.getElementById("error-state"),x=document.getElementById("retry-button");async function y(){try{r&&r.classList.remove("hidden"),m&&m.classList.add("hidden"),console.log("Testing API connection...");const g=await fetch("/api/test");if(console.log("Test endpoint status:",g.status),!g.ok)throw new Error("Test endpoint failed");console.log("Fetching projects...");const s=await fetch("/api/projects",{headers:{Accept:"application/json","Content-Type":"application/json"}});if(console.log("Projects response status:",s.status),!s.ok){const o=await s.text();throw console.error("Projects API error:",o),new Error("HTTP error! status: "+s.status)}const C=await s.json();if(console.log("Projects API response:",C),n){n.innerHTML="";const o=(C?.data||[]).sort((t,d)=>t.created_at?d.created_at?new Date(d.created_at).getTime()-new Date(t.created_at).getTime():-1:1);if(console.log("Proyectos ordenados:",o.map(t=>({title:t.title,created_at:t.created_at}))),o.length===0){n.innerHTML=`
                <div class="text-center py-12">
                  <p class="text-gray-400">No projects found.</p>
                </div>
              `;return}const h=document.createElement("div");h.className="grid grid-cols-1 lg:grid-cols-2 gap-8 mt-12",console.log("Proyectos cargados:",o),o.forEach((t,d)=>{console.log(`Procesando proyecto ${d+1}/${o.length}:`,t.title),console.log("Datos del proyecto:",{title:t.title,hasImageUrl:!!t.image_url,imageUrl:t.image_url});const l=document.createElement("div");l.className="group relative overflow-hidden rounded-2xl bg-dark-800/50 backdrop-blur-sm border border-dark-700/50 shadow-xl transition-all duration-300 hover:border-primary-400/30 hover:shadow-lg hover:shadow-primary-500/10 hover:-translate-y-1",l.setAttribute("data-aos","fade-up"),l.setAttribute("data-aos-delay",String(d*100));const i=document.createElement("div");if(i.className="relative overflow-hidden aspect-video",t.image_url&&t.image_url.trim()!==""){console.log(`[${t.title}] Procesando imagen:`,t.image_url);try{const e=document.createElement("img");let a=t.image_url;a.startsWith("http")?a=a.replace("http://","https://"):a.startsWith("/")||(a=`/${a}`),console.log("Cargando imagen:",a),e.src=a,e.alt=t.title||"Project image",e.className="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105",e.loading="lazy",e.style.display="block",e.onerror=function(){console.error("Error al cargar la imagen:",a),this.onerror=null,this.src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0MDAiIGhlaWdodD0iMzAwIiB2aWV3Qm94PSIwIDAgNDAwIDMwMCIgZmlsbD0iIzFhMjEyOSI+PHJlY3Qgd2lkdGg9IjQwMCIgaGVpZ2h0PSIzMDAiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjE0IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBhbGlnbm1lbnQtYmFzZWxpbmU9Im1pZGRsZSIgZmlsbD0iI2ZmZiI+SW1hZ2Ugbm90IGZvdW5kPC90ZXh0Pjwvc3ZnPg=="},i.appendChild(e),console.log("Imagen agregada al DOM")}catch(e){console.error("Error al crear la imagen:",e)}}else{const e=document.createElement("div");e.className="w-full h-full bg-dark-700 flex items-center justify-center";const a=document.createElement("i");a.className="fas fa-image text-4xl text-gray-600",e.appendChild(a),i.appendChild(e)}const I=document.createElement("div");I.className="absolute inset-0 bg-gradient-to-t from-dark-900/90 via-dark-900/20 to-transparent group-hover:from-dark-900/80 group-hover:via-dark-900/10 transition-all duration-500",i.appendChild(I);const p=document.createElement("div");p.className="absolute bottom-0 left-0 right-0 p-6";const f=document.createElement("h3");f.className="text-2xl font-bold text-white",f.textContent=t.title;const b=document.createElement("p");b.className="text-sm text-gray-300 mt-1",b.textContent=t.category||"Web Development",p.appendChild(f),p.appendChild(b),i.appendChild(p),l.appendChild(i);const c=document.createElement("div");c.className="p-6";const v=document.createElement("div");if(v.className="flex flex-wrap gap-2 mb-4",t.technologies&&t.technologies.length>0&&t.technologies.forEach(e=>{const a=document.createElement("span");a.className="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-dark-700/80 text-gray-200 border border-dark-600/50 group-hover:border-primary-400/30 transition-all duration-300",a.textContent=e,v.appendChild(a)}),c.appendChild(v),t.description){const e=document.createElement("p");e.className="text-gray-300 mb-6 leading-relaxed",e.textContent=E(t.description,150),c.appendChild(e)}const u=document.createElement("div");if(u.className="flex flex-wrap gap-3",t.github_url){const e=document.createElement("a");e.href=t.github_url,e.target="_blank",e.rel="noopener noreferrer",e.className="inline-flex items-center px-4 py-2 bg-dark-600 hover:bg-dark-500 text-white rounded-lg text-sm font-medium transition-all duration-300",e.setAttribute("aria-label","View on GitHub");const a=document.createElement("i");a.className="fab fa-github mr-2",e.appendChild(a),e.appendChild(document.createTextNode("Code")),u.appendChild(e)}if(t.live_url){const e=document.createElement("a");e.href=t.live_url,e.target="_blank",e.rel="noopener noreferrer",e.className="inline-flex items-center px-4 py-2 border border-primary-500/30 hover:border-primary-400/50 text-primary-400 rounded-lg text-sm font-medium transition-all duration-300 hover:bg-primary-500/10 hover:text-white",e.setAttribute("aria-label","View live demo");const a=document.createElement("i");a.className="fas fa-external-link-alt mr-2",e.appendChild(a),e.appendChild(document.createTextNode("Live Demo")),u.appendChild(e)}c.appendChild(u),l.appendChild(c),h.appendChild(l)}),n.appendChild(h)}}catch(g){console.error("Failed to load projects:",g),r&&r.classList.add("hidden"),m&&m.classList.remove("hidden")}}y(),x&&x.addEventListener("click",y)});
